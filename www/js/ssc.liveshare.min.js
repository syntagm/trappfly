/*Live Share - 0.8: Licensed under the SpreadsheetConverter ;2014-08-22 */function onopen_callback(){this.connected=!0,ssc.liveshare.connected&&this.callback({onopen:"connected successfully."}),this.nodejs||this.connection.send("client-connected")}function onclose_callback(a){if(a.reason&&a.reason.length>1)this.callback(!1,"You have been disconnected. Reason :- "+a.reason);else{if(!this.connected)return this.callback(!1,"Could not connect to Live Share server, ensure your network connection and try again. If problem persists, please contact SpreadsheetConverter support."),0;var b=this.itigger;this.itigger=!1,this.callback({onclose:"You are now disconnected.",itigger:b})}this.connected=!1,this.connection=!1,this.usersCount=0}function onerror_callback(){this.debug&&$(this.debugWindowId).html($("<p>",{text:"Sorry, but there's some problem with your connection or the server is down."})),this.callback("","Sorry, but there's some problem with your connection or the server is down.")}function onmessage_callback(a){try{var b=JSON.parse(a.data)}catch(c){return}if("me"===b.type)this.myColor=b.data.color,this.myId=b.data.id;else if("count"===b.type)this.usersCount=b.users.length,this.liveUsers=b.users,this.callback({message:b.users});else if("history"===b.type){var d=JSON.parse(b.data.text);for(var e in d)document.getElementById(e).value=d[e];recalc_onclick("no-resent")}else if("message"===b.type){var f=processMessageData(b.data);f&&recalc_onclick("no-resent")}else b.hasOwnProperty("error")&&alert("Live Share encountered unsupported message \n"+b.error.unknowncmd);this.debug&&this.logRawDataInDebugWindow(a.data)}function arrayObjectIterator(a,b){if(a instanceof Array){for(var c in a)if(a.hasOwnProperty(c))for(var d in a[c])a[c].hasOwnProperty(d)&&b(d,a[c][d])}else for(var c in a)b(c,a[c])}function getUrlVars(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split(/[# &]+/),d=0;d<c.length;d++)a=c[d].split("="),b.push(a[0]),b[a[0]]=a[1];return b}function getHref(){var a=window.location.href;return a.indexOf("?")>-1&&(a=a.substr(0,a.indexOf("?"))),a}function updateWidgetForLiveShare(obj){var widgetType=obj.attr("data-widgettype"),elemId=obj.attr("id");if("datepicker"==widgetType){var str="$('#datepicker_"+elemId+"').datepicker('setDate',$('#"+elemId+"').val());";eval(str)}else{var strExe="$('#"+widgetType+"_"+elemId+"')."+widgetType+"('value',"+obj.val()+");";"slider"==widgetType&&(strExe=strExe+"$('#"+widgetType+"_"+elemId+"').find('a').attr('title', 'slider value='+$('#"+widgetType+"_"+elemId+"')."+widgetType+"('option','value'));"),eval(strExe)}}function isBrowserSupportsWS(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\bOPR\/(\d+)/),null!=a)?"Opera "+a[1]:(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),"Chrome"==c[0]&&c[1]>=16||"MSIE"==c[0]&&c[1]>=10||"Firefox"==c[0]&&c[1]>=11||"Safari"==c[0]&&c[1]>=6||"Opera"==c[0]&&c[1]>=12?!0:!1)}!function(a,b,c){function d(){var b=getUrlVars().k,c="<div class='alert alert-success alert-dismissable errormessage text-center '>            <button id='btnBannerPane' type='button' class='close' onclick='closeBannerPane_callback()'>&times;</button>            <strong>This form is LiveShare enabled.</strong> Your changes in the form will be shared in group : <strong>"+b+"</strong> &nbsp;&nbsp;&nbsp; Please fill your name or email in <a href='#txtWsEmail' onclick='javascript:$(\"#txtWsEmail\").focus();'>LiveShare Settings  </a><span class='glyphicon glyphicon-bookmark'></span> at toolbar below.       <a href='http://www.spreadsheetconverter.com/liveshare-share-webpage/'><span style='float:right' title='learn more in our website.' data-toggle='tooltip' data-placement='left' class='glyphicon glyphicon-question-sign'></span></a>        </div>";b&&(e.liveshare("autoConnect",b),-1===ssc.liveshare.hasShareDataToken()&&a("body").append(c))}var e;b.ls_=!0,a(function(){var b=(ssc.liveshare.connection,"https:"==c.location.protocol?"wss:":"ws:"),f=b+"//share.spreadsheetconverter.com/share2_ws.yaws";uqs_debug=getUrlVars().d,uqs_nodejs=getUrlVars().n,el_inputs=a('input:not(":button,[readonly=readonly],:disabled"),select,a.ui-slider-handle,textarea,a.ui-state-active',"#formc"),1==uqs_debug&&(ssc.liveshare.debug=!0,a("body").append('<div id="debugWindow" class="center"></div>')),1==uqs_nodejs?(ssc.liveshare.nodejs=!0,f=b+"//share2.spreadsheetconverter.com:3000/"):2==uqs_nodejs&&(ssc.liveshare.nodejs=!0,f=b+"//127.0.0.1:3000/"),e=a("section#ssc-ls").liveshare({websocketUrl:f}),d(),a(".dropup").on("show.bs.dropdown",function(){a(".popover").hasClass("in")&&(a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy"))}),el_inputs.focus(function(){if(ssc.liveshare.connection&&1==ssc.liveshare.connection.readyState){var a={};a.edit=this.id,ssc.liveshare.connection.send(JSON.stringify(a))}}),el_inputs.blur(function(){if(ssc.liveshare.connection&&1==ssc.liveshare.connection.readyState){var a={};a.unedit=this.id,ssc.liveshare.connection.send(JSON.stringify(a))}}),a("div[id^=slider_]").on("slidestop",function(a,b){ssc.liveshare.messageSend_setvalues(a.target.id.replace("slider_",""),b.value)})}),b.closeBannerPane_callback=function(){a("#btnBannerPane").alert("close");var b=getUrlVars().k;b&&-1===ssc.liveshare.hasShareDataToken()&&ssc.liveshare.rememberShareDataToken(b)};var f,g=g||{};g.Widget="		<div class='btn-group dropup' style='display:inline-block; float:right; margin:16px 0 0 0;'>                <button id='btnLiveShare' type='button' class='btn btn-primary btn-xs'><span class='glyphicon glyphicon-transfer' style='margin-right: 2px;'></span>                    Live Share                </button>                <button id='btnUserList' type='button' class='btn btn-primary dropdown-toggle btn-xs' data-toggle='dropdown'>                    <span id='liveuserscount' class='badge pull-left' style='margin-top: 2px; margin-right: 5px'>0</span>                    <span class='caret'></span>                    <span class='sr-only'>Toggle Dropdown</span>                </button>                <ul id='liveuserslist' class='dropdown-menu pull-right' role='menu'>                    <li>&nbsp;&nbsp;No one is connected.                   </li>                </ul>            </div>",g.LiveSharePopover="<div class='row'>            <div class='col-md-12 col-sm-12 text-center'>                <span id='pnlWsError' class='ui-state-text'></span>            </div>        </div>        <div class='row'>            <div class='col-md-12'>                <label for='lsSecretKey' data-toggle='tooltip' data-placement='left' title='provide unique name, so you can use it to save/share/collabrate this form.'>Secret key :                    </label>            </div>            <div class=' col-md-12 col-sm-12'>             <div class='input-group'>                 <input id='txtWsSecretkey' type='text' class='form-control input-sm' id='lsSecretKey' placeholder='secret key' title='provide unique name, so you can use it to save/share/collabrate this form.'>                 <span class='input-group-btn'>                    <button id='btnWsConnect' type='button' data-loading-text='Connecting...' class='btn btn-sm btn-primary wsconnect' style='margin-top: 0px' >Connect</button>                 </span>             </div>            </div>        </div>        <!--</div>-->        <div class='row'>            <div class='col-md-12'>                <label for='txtWsEmail' title='provide your name, so it is used during collaboration'>Your name or email :</label> <i>(optional)</i>            </div>        </div>        <div class='row'>            <div class='col-md-12 col-sm-12'>                <div class='input-group'>                    <input id='txtWsEmail' type='email' class='form-control input-sm' placeholder='name or email' data-toggle='tooltip'                           data-placement='left' title='provide your name, so it is used during collaboration'>                    <span class='input-group-btn'>                               <button id='btnWsEmailShare' type='button' class='btn btn-sm btn-default' style='color: #428bca;'>Share</button>                        </span>                </div>                <span>                    <i>                       It will appear in other's screen.                    </i>                </span>            </div>        </div>        <section id='shareUrl'>        <div style='margin-top: 8px;' class='row'>            <div class='col-md-6'>                <button id='btnShareUrl' type='button' class='btn btn-link btn-xs' data-toggle='tooltip' data-placement='left'                        title='Provides the URL to share'><span class='glyphicon glyphicon-share' style='margin-right: 2px'></span>Share for Collaboration</button>            </div>        </div>        </section>",g.getShareUrlPopover="<div>             <p style='width: auto'>Hit <strong>Ctrl + C</strong> to copy the link below.  <br/> Send this to others to start Live Share with. </p>             <input id='txtDataShareUrl' class='form-control' type='text' style='width: 100%' value=''/>         </div>",g.BrowserNotSupport="<div>Your browser does not support Live Share feature. \nPlease use Google Chrome, Firefox or Internet Explorer 10 or above.</div>",a.widget("ssc.liveshare",{options:{websocketUrl:"ws://127.0.0.1:3000/",autoHidePanel:!0},_create:function(){f=this,this.element.prepend(g.Widget),this.element.on("click","#btnLiveShare",this._showLiveSharePopover),this.element.on("click","#btnWsConnect",this._connectWebSocket),this.element.on("click","#btnWsEmailShare",this._postEmailShare),this.element.on("click","#btnShareUrl",this._showGetShareUrlPopover),this.element.on("keypress","#txtWsSecretkey",this._enterToConnect),this.element.on("keypress","#txtWsEmail",this._enterToShareNameEmail)},_showLiveSharePopover:function(){if(a(".popover").hasClass("in")?(a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")):a("#btnLiveShare").popover({trigger:"manual",placement:"top",html:!0,content:function(){return b.isBrowserSupportsWS()?g.LiveSharePopover:g.BrowserNotSupport},title:'<span class="text-info"><strong>Settings</strong></span><a href="http://www.spreadsheetconverter.com/support/tutorials/liveshare-share-webpage/" target="_blank" style="float: right;text-decoration: underline;">About Live Share</a></h3>'}).popover("show"),ssc.liveshare.secretKey&&a("#txtWsSecretkey").val(ssc.liveshare.secretKey),ssc.liveshare.myEmail&&a("#txtWsEmail").val(ssc.liveshare.myEmail),ssc.liveshare.connected){var c=a("#btnWsConnect");c.text("Disconnect").addClass("btn-success")}a("#txtWsSecretkey").on("input propertychange paste",function(){ssc.liveshare.connected&&ssc.liveshare.disconnect(!0)})},_showGetShareUrlPopover:function(){a("#btnLiveShare").popover("destroy");var c=getHref();if(ssc.liveshare.secretKey){var d=c+"?k="+ssc.liveshare.secretKey;b.location.href.indexOf("n=1")>-1&&(d+="&n=1"),a("#btnLiveShare").popover({trigger:"manual",placement:"top",html:!0,content:function(){return g.getShareUrlPopover},title:'<span class="text-info"><strong>Share for Collaboration</strong></span><button type="button" id="close" class="close" onclick="$(&quot;#btnLiveShare&quot;).popover(&quot;destroy&quot;);">&times;</button>'}).popover("show"),a("#txtDataShareUrl").val(d),a("#txtDataShareUrl").select()}},_connectWebSocket:function(){var c=f.options.websocketUrl;if(btnWsConnect=a(this),ssc.liveshare.connected)ssc.liveshare.connected&&(ssc.liveshare.disconnect(),btnWsConnect.text("Connect").removeClass("btn-success").addClass("btn-primary"));else{btnWsConnect.button("loading");var d=a("#txtWsEmail").val();d&&(ssc.liveshare.myName=d),ssc.liveshare.formUrl=getHref(),ssc.liveshare.secretKey=a("#txtWsSecretkey").val(),a("#txtWsEmail").val().length>1&&(ssc.liveshare.myEmail=a("#txtWsEmail").val());var e,g=f.options.autoHidePanel;ssc.liveshare.openWebSocket(c,function(c,d){if(d){e&&b.clearTimeout(e),a("#pnlWsError").text(d),a("#pnlWsError").css({color:"#cd0a0a"});try{a("div.popover").css({top:-1*parseInt(a(".popover")[0].offsetHeight,10)})}catch(h){}ssc.liveshare.connected||(a(liveuserscount).text("0"),a("#liveuserslist").empty(),a("#liveuserslist").html("&nbsp;&nbsp;No one is connected."),a("#btnWsConnect").text("Connect").removeClass("btn-success").addClass("btn-primary"),a("#btnLiveShare").removeClass("btn-success"),a(b).unbind("beforeunload"))}else if(c.hasOwnProperty("onopen")){btnWsConnect.button("reset"),a("#pnlWsError").empty(),a("#pnlWsError").text("You are now connected."),a("#pnlWsError").css({color:"#47a447"});try{a("div.popover").css({top:-1*parseInt(a(".popover")[0].offsetHeight,10)})}catch(h){}a("#btnWsConnect").text("Disconnect").addClass("btn-success"),a("#btnLiveShare").addClass("btn-success"),g?e=b.setTimeout(function(){a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")},3e3):f.options.autoHidePanel=!0,a(b).bind("beforeunload",function(){return"You have been connected to a Live Share session. If you navigate away from this page, your connection will be lost and you need to connect again."})}else if(c.hasOwnProperty("message")){a("#liveuserscount").text(c.message.length),a("#liveuserslist").empty();for(var i=0;i<c.message.length;i++){var j=ssc.liveshare.myId===c.message[i].id?'<span class="glyphicon glyphicon-user"></span>':"";a("#liveuserslist").append('<li><div class="userlist"><div class="flag" style="background-color: #'+c.message[i].flag+'">'+j+'</div><span class="text">'+c.message[i].user+"</span></div></li>")}}else if(c.hasOwnProperty("onclose")){a("#pnlWsError").text(c.onclose),a("#pnlWsError").css({color:"#cd0a0a"});try{a("div.popover").css({top:-1*parseInt(a(".popover")[0].offsetHeight,10)})}catch(h){}a(liveuserscount).text("0"),a("#liveuserslist").empty(),a("#liveuserslist").html("&nbsp;&nbsp;No one is connected."),a("#btnWsConnect").text("Connect").removeClass("btn-success").addClass("btn-primary"),a("#btnLiveShare").removeClass("btn-success"),c.itigger||b.setTimeout(function(){a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")},3e3),a(b).unbind("beforeunload")}})}},_postEmailShare:function(){if(ssc.liveshare.connected){var c=a("#txtWsEmail").val();c=c.trim(),c.length>0&&(ssc.liveshare.myEmail=c,ssc.liveshare.shareMyEmail(c),a("#pnlWsError").text("Your name or email has been shared."),a("#pnlWsError").css({color:"#47a447"}),a("div.popover").css({top:-1*parseInt(a(".popover")[0].offsetHeight,10)}),b.setTimeout(function(){a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")},3e3),a("#btnBannerPane").alert("close"))}},_enterToConnect:function(b){var c=b.keyCode?b.keyCode:b.which;"13"==c&&a("#btnWsConnect").click()},_enterToShareNameEmail:function(b){var c=b.keyCode?b.keyCode:b.which;"13"==c&&a("#btnWsEmailShare").click()},destroy:function(){a.Widget.prototype.destroy.call(this)},autoConnect:function(b){f.options.autoHidePanel=!1,this._showLiveSharePopover(),a("#txtWsSecretkey").val(b),a("#btnWsConnect").click(),a("#txtWsEmail").focus()},methodA:function(a){this._trigger("dataChanged",a,{key:"someValue"})},_setOption:function(b){switch(b){case"websocketUrl":break;case"autoHidePanel":}a.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery,window,document),window.WebSocket=window.WebSocket||window.MozWebSocket;var ssc=ssc||{};ssc.liveshare={debugWindowId:"#debugWindow",connected:!1,formUrl:!1,secretKey:!1,myName:!1,myColor:!1,myEmail:!1,myId:-1,usersCount:!1,connection:!1,liveUsers:[],debug:!1,nodejs:!1,LOCAL_STORAGE_PREFIX:"invoice_",openWebSocket:function(a,b){this.callback=b;var c=ssc.liveshare.myName.length>0?"&name="+ssc.liveshare.myName:"";this.connection=new WebSocket(a+"?url="+ssc.liveshare.formUrl+"&key="+ssc.liveshare.secretKey+c),this.connection.onopen=onopen_callback.bind(this),this.connection.onclose=onclose_callback.bind(this),this.connection.onerror=onerror_callback.bind(this),this.connection.onmessage=onmessage_callback.bind(this)},itigger:!1,disconnect:function(a){this.itigger=a||!1,this.connection.close()},rememberShareDataToken:function(a){if(window.localStorage)try{{var b=APPNAME+"_"||"Token";window.localStorage[b]||0}window.localStorage[b]=a}catch(c){}},hasShareDataToken:function(){if(!window.localStorage)return-1;try{var a=APPNAME+"_"||"Token",b=window.localStorage[a]||-1;return b}catch(c){return-1}},ShowDisconnectAlert:function(a){var b='<div id="lsDisconnect" class="alert alert-info alert-dismissable" style="float:top;position:absolute;margin-top:-45px; margin-left:50px">  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>  <strong>Info!</strong> You are disconnected from Live Share.</div>';a.before(b),setTimeout(function(){$("#lsDisconnect").alert("close")},3e3)}};var processMessageData=function(a){var b=!1;if(a.hasOwnProperty("edit")){var c,d={user:"owl",flag:"A2D959"};if(a.edit.hasOwnProperty("el"))c=a.edit.el,d={user:a.edit.author,flag:a.edit.flag};else{c=Object.keys(a.edit)[0];var e=a.edit[c],d=getLiveUserById(e)}$("#"+c).qtip({content:{text:d.user},position:{my:"center left",at:"top right",target:$("#"+c),adjust:{x:3,y:13}},style:{bgColor:"#"+d.flag,color:"#FFFFFF",borderColor:"#"+d.flag},hide:!1}).qtip("show")}else if(a.hasOwnProperty("unedit")){var f=a.unedit.hasOwnProperty("el")?a.unedit.el:Object.keys(a.unedit)[0];$("#"+f).qtip("destroy")}else if(a.hasOwnProperty("setvalues")){b=!1;var g=!1,h=!1;if(a.setvalues instanceof Array?a.setvalues.length>0?g=!0:h=!0:"object"!=typeof a.setvalues||isEmptyObject(a.setvalues)||(g=!0),g&&a.setvalues&&arrayObjectIterator(a.setvalues,function(a,c){var d=a,e=$("#"+d.replace("$","\\$"));e.is("input:text,textarea")||e.is("select")?e.val()!=c&&(e.val(c),"none"==e.css("display")&&void 0!=e.attr("data-widgettype")&&updateWidgetForLiveShare(e),b=!0):e.is("input:checkbox")?document.getElementById(d).checked!=c&&(document.getElementById(d).checked=c,b=!0):e.is("input:radio")?1!=e.prop("checked")&&(e.prop("checked",!0),b=!0):$("[input[name="+d+"]").is("input:radio")&&1!=$("[input[name="+d+"][value="+c+"]").prop("checked")&&($("[input[name="+d+"][value="+c+"]").prop("checked",!0),b=!0)}),h){var i={};i.setvalues=[];var j=$('#formc input:not("[readonly=readonly],[id^=xl_][id^=hS]"),textarea,select').serializeObject();$.each(j,function(a,b){var c={};c[a]=b,i.setvalues.push(c)});{$("input:checkbox").each(function(){if(0==$(this).prop("checked")){var a={};a[$(this).attr("name")]=$(this).prop("checked"),i.setvalues.push(a)}})}i.setvalues.length>0&&ssc.liveshare.connection.send(JSON.stringify(i))}}return b},isEmptyObject=function(a){return 0===Object.keys(a).length},getLiveUserById=function(a){var b=ssc.liveshare.liveUsers.filter(function(b){return b.id==a});return b[0]};ssc.liveshare.apply=function(a,b,c,d){var e=!1,f=$.parseJSON(d);for(var g in f){if("edit"==g){$("#"+f[g]).qtip({content:{text:a},position:{my:"center left",at:"top right",target:$("#"+f[g]),adjust:{x:3,y:13}},style:{bgColor:"#"+b,color:"#FFFFFF",borderColor:"#"+b},hide:!1}).qtip("show");break}if("unedit"==g){$("#"+f[g]).qtip("destroy");break}for(var h in f[g])for(var i in f[g][h])"setvalues"==g&&(e=!0,document.getElementById(i).value=f[g][h][i])}return e},ssc.liveshare.addInDebugWindow=function(a,b,c,d){var e='<p><span class="qtip-'+c+'">'+a+"</span> @ "+ +(d.getHours()<10?"0"+d.getHours():d.getHours())+":"+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())+": "+b+"</p>";$(ssc.liveshare.debugWindowId).prepend(e)},ssc.liveshare.logRawDataInDebugWindow=function(a){$(ssc.liveshare.debugWindowId).prepend("> "+a+"<br/>")},ssc.liveshare.coUpdate=function(a,b){if(ssc.liveshare.connection&&1==ssc.liveshare.connection.readyState&&""!==b&&"no-resent"!==b&&"slider"!=$("#"+b).attr("data-widgettype")){var c=a[b];ssc.liveshare.messageSend_setvalues(b,c)}},ssc.liveshare.messageSend_setvalues=function(a){if(ssc.liveshare.connection&&1==ssc.liveshare.connection.readyState){var b={setvalues:[]},c={},d=$("#"+a.replace("$","\\$"));if(d.is("input:text, textarea")&&a.indexOf("aux")<1&&"readonly"!=d.attr("readonly")||d.is("select"))c[a]=d.val().trim();else if(d.is("input:checkbox")){var e=document.getElementById(a).checked;void 0!=e&&(c[a]=e)}else if(d.is("input:radio")){var e=document.getElementById(a).value;void 0!=e&&(c[document.getElementById(a).name]=e)}isEmptyObject(c)||b.setvalues.push(c),b.setvalues.length>0&&ssc.liveshare.connection.send(JSON.stringify(b))}},ssc.liveshare.shareMyEmail=function(a){if(ssc.liveshare.connection&&1==ssc.liveshare.connection.readyState){var b={setemail:a};ssc.liveshare.connection.send(JSON.stringify(b))}},$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};